// ==UserScript==
// @name        IMDb: Link 'em all!
// @description Adds all kinds of links to IMDb, customizable!
// @namespace   https://greasyfork.org/en/users/8981-buzz
// @match       *://*.imdb.com/title/tt*/*
// @connect     *
// @require     https://greasemonkey.github.io/gm4-polyfill/gm4-polyfill.js
// @require     https://unpkg.com/preact@10.4.5/dist/preact.umd.js
// @require     https://unpkg.com/preact@10.4.5/hooks/dist/hooks.umd.js
// @license     GPLv2
// @noframes
// @author      buzz
// @version     2.0.0
// @grant       GM_getValue
// @grant       GM_setValue
// @grant       GM_xmlhttpRequest
// @grant       GM.getValue
// @grant       GM.setValue
// @grant       GM.xmlHttpRequest
// ==/UserScript==

!function(e,t){"use strict";function n(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,o)}function r(e){return function(){var t=this,r=arguments;return new Promise((function(o,i){var a=e.apply(t,r);function s(e){n(a,o,i,s,l,"next",e)}function l(e){n(a,o,i,s,l,"throw",e)}s(void 0)}))}}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(e,t)||u(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e){return function(e){if(Array.isArray(e))return A(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||u(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){if(e){if("string"==typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A(e,t):void 0}}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var p="https://github.com/buzz/imdb-link-em-all#readme",f="Link 'em all! v".concat("2.0.0"),h={enabled_sites:[],fetch_results:!0,first_run:!0,open_blank:!0,show_category_captions:!0},_={search:"Search",movie_site:"Movie sites",pub_tracker:"Public trackers",priv_tracker:"Private trackers",streaming:"Streaming",filehoster:"Filehosters",subtitles:"Subtitles",tv:"TV"},g=0,d=1,b=2,m=3,S=4,y=5;function C(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===n&&r.firstChild?r.insertBefore(o,r.firstChild):r.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}var v="Options_options__8dIDU";C(".Options_options__8dIDU{margin-top:10px}.Options_options__8dIDU>label>span{margin-left:10px}");var w=function(t){var n=t.options.map((function(t){var n=l(t,4),r=n[0],o=n[1],i=n[2],a=n[3];return e.h("label",{key:r},e.h("input",{checked:i,onInput:function(e){return a(e.target.checked)},type:"checkbox"}),e.h("span",null,o),e.h("br",null))}));return e.h("div",{className:v},n)};var k={error:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACJklEQVQ4y6VTTUiUYRB+vh93dX903bKUYMNlMWHJBC1WW8GjZVCnfpa6Fp1i6dilQwcJglgrDEKiQqhDRYWVCEsSFJ0Ksh8zKjJZ3V0WU3G/73tnpoNrFGkZzmHmMDPPPM8wA6zRtJUSuXSHISSvhLnALJ21Xc9ouTp9JQAhSblqd0VdG7viQnz0v2hlh+PBqaH272TPiF0Ylcl72/MTd1qCq2bAxNcqQgm/puswvUF46hNBIT6zqulTj9ubMw9jJGSJNXVB7Gy/sJ2TLze3qc8DW5v/yUCYb/gakzqrOXwcuoXxR1fBTgaBppMGE/f+FSAzGEuUVbdFvZv3YeFrEiKACFCc6IE/0g13bUf8w5WGxLIAmcGYj5lTnvABsMoDXOoWAbMDLo6hqvEgmPjsu0th3x8ATNzvCe1f564Ow8ndBiAoD3iWhMHKXERFTQiVWw5tUkXn1G+HNHl/R0SY39btTpu08BLO9GUwA3pZOeZzs3B7GYYhMCo7Yfj3YrS31SZLRVtO58f1xaPhAV/DcVN4DjT7HBAGIPg08h7TbyYBCCAMVRiGps+jJpZ0Kcs5DwDat7ut3UZV04MNHSmo2SdwstcXJbFARAME0A2BJjZECLqxHuX1PXjdl8DM2Mgek4n6ApHDAADT1w7T11YSpy3JLzn5uQ9oLtTtPIbCaPqcKcTp7NMTR4QYTIxfIzkEshwoywFZDshSIFuBHAIrAit6sdZvxg9QwSUH1+qgEQAAAABJRU5ErkJggg==",cog:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACiElEQVQ4y41TzUpyURQVH8C5j+B7OGkSVJPQJlYQFSZOFJNCq4tEQoNqoIYo5Q+lUIJJUln5U6lXS0yU0kEWFwUdOb13t/eB/BC+oDO53HPOWnuttc+WyX5ZhUJh7uHhIZXJZFK45mR/WS8vL6pSqaRAsBzB3a+vL/j8/IRIJNK9uLiQx2IxRTQaVf0G9iBYzOfzQi6XU97f3wutVguazSYgUDg/P1cikRAKhcSjoyPPCPj5+dn6/v4OvV4P3t7eAMGDm5sbqVarQbVahbOzMwnBA1QGgiBAIpGAnZ0d65AAq66hV4lICNBoNBjRDwH9VyoVIILHx0ewWCyS0WhcG1GRzWY5ulwsFuHp6QmSySQcHh6C3+8nRYC24O7ujlXf3t7mhkBk5LF6+/b2tl+v14Hnebi6uoKNjY2c2WxWr6+vq3d3d3PpdJoR0bnT6ew7HI725uYmL0Ow2Ol0mFyqjEFCIBCAra0t9U8Rt9utxgwA7zJlpIbCXV5eFmXYY/Hj44N5pAOqgInD3t7ekODg4EAdDoeZArKAatl9nU4nyrAlPEps+3y+frlcZiSUg9frzblcLvX+/j6zQP7J2uXlJczPz/enp6fbU1NT/DALlMhhkCwo+uJDgpOTE8C+sz1sK8Tjcba3uLjIjXTg9PR0LRgMSq+vrwxM7cKHxTIhIlJE+9fX1+xsZWVFWlhY+NfG4+NjK8mjl4dEgOkOOI6TKDTyrdfrJQQN6Iy822w2mJyctI6osNvtHoPBIKI/wWQyKZFEoGqkYHZ2VtBoNEr0LYyPj4tjY2Oe/84DEqiWlpYUq6urciTskmScA9BqtV0kkM/MzCiQQPWnyUTZc1gxNTExkUK5v47zN4DwH7fniYcmAAAAAElFTkSuQmCC",lock:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACfUlEQVQ4y21Sz2sTQRh9u9nml02M2hoapaZNtaIg4q0eBMEeRPGg3jyJhyK00EvpsZBr/wqhAfHQs3fBglRa0EYTm5YYFEqKSRvTJDs7s77ZbdpYHfiYmW++7817b8bAiZHL5fqVUnNSygnGWQYYvxgrjuMszs7O/u6tN3o3S0tLN9m8nEqlRuLxOEzTBPdot9uoVqvY5iDQ4/n5+fV/ANjcz8O1TCYzZts2KpUKms2mvh2WZSGZTHp1+Xx+k7kbCwsLLb03uwBMvhwaGhoTQqBYLG41Go0010Edel0oFH5qYLIbo5Tpbp/VXTA5EY1GUSqVwKaHMzMz5R515Ww2e69cLufT6bRX+z+AQa2Zt+n19klzdU6z0zVkO/iXB+V3z92V0jh29iKe5kfXVxFwBVzpwHX8EELi1fotz9RkuIYHF1ZxdWrN8Bm4Lp4+uUs0E0Ygwvk+oIhthfUhDRKQTgPZySbzwmvZfP3+WIK+SRc6u29ghQZgGP0s7AMiCaYVcLAHuf8NdusHlHOAyMg0XLvTA0CKUPomG/WNj9R5Colrt1F5u8j+8xi+M4n61w0C1BBLnyFhCVfYvQDCk+GSamL8CszgAN1RkB2JT7sRDMNGIjOCdjPE2gOPVRfA+wcu3dWoWmvt8zpZfOCJA9VW6LRI1SWzwhfUi999uUp5PccM9EajUkLichqB6DkC2Bh9NoVRwYb9HZzOpBDc7/MZUO4JANtDVY72YIMAMSBMI60g8xqgjlatCtFsIDYcp93Kl90LoCWELr5A5FIARjDkP6HJl1CUZrcQazWosEOi0vdLG38EwCfZWp7zvfA+jjgM52jmD/M/lpT+WgNx/AHLKabZmE0zigAAAABJRU5ErkJggg==",tick:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABoklEQVQ4y9WT2S5DURSG3TnOu6ipVUPFlJCqIdVS6nBKKS2NG6qno5aSEsNxKeahIikaiiASl2qo8AziJVR/WxNTL6R6IbEud/aX9e9vrZ2S8u9KtVbL1y9WOZOCG1dreOOBFvo9FlK+lPsV3LBSzfftd2Dm3g3PpQUanwrFo3nWhGDlsow3BDSYunNh8s6J9q0mlHjyUeAQUh+XDGdsefcx0xUPK5Zk/FvkibAT3rAj1rnILY7k23O+wKesRHfEPHEXRrD+hv73cyKL79ltg/fWjvFbG9jNRkhcuZE8W/YnrD9pq9AdtjyOhThMhYeh9skjRFa/fEE62b3DYOzGBs81h9YNJQqHRRGxNYv6FrErqE7TBpphOu/F7MMoPCELDPsaGINajITMcF+bwawrUOAUvuRa4uD3YrYVNOkM46E29s7xGytcVya4Qiao1+rfZEVFXCb1o2kii5bPS9Hpb4H7agiOywE0r8hBZEVF5gwqoXFJ58royukSElkJ1XIdiKyocEhA/WphyHzpohExiKznHJMgNamVJbLo7MH01D/5XK8FJMUEaMuG0gAAAABJRU5ErkJggg==",timeout:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAC4klEQVQ4y62TXUjTURjGjel90U03XdhF1EVQXQRBQVheGpGFGShIAyX1wu/5lVlpZllqTE3TqZu5zeYHmm66+cU0tc21mcvpPpwzvzbnf85N/at7OhNaSRFd9MLDeTmH5/e+5+UcP7//HX38wqDhpgcyZTtr9bM4k1Z2ZNByQcKSpDqhtfVNxsW/mgeF+WWabta2RTeClUUDHA47KMqG+VkNNHI+xG+jNwSv4rL/aO7n55XoFeWwW83Qme1432tCmWgSpcIv4HbpMT69BJNuGJ1VMeDkMVMOmCXcgkuK9mTatmzCoGoBzX0m6C0O2BxOWB0b0M05wO3Wo2XAiClVF3iP77iq8u+f8wGkdWmdM+Tg6+wqhDIjvGGnKEx/W8Qmyb1yeoCKDj3kajN6eEmoyArn+gC99fGLC+YJ8CQz0JLKrh0PnC4X2DUcLBPQ+tYWRJJeDE5TeN6oxsSYAFWZoSYfQFYXt2m3zaOwQY1lNw371h62SdX0h7ngNbchLScX3cOjmKBoJLJHMWcaRU3mLbcPIK6M3rStGJDLUWHOSRPIHizUOp68KNo3D6o0sO4AChuN+OKPMBsGUJ0e+hMgehlpNEx0oVioxsAMhQVyacs6jc7+IRhXHVjaBTRNbPRGnII0KADS0KNojDhN+QC1eZGcfgELw+ppFAh1sJKB2WlgfY+I5DMtZdCkXsbmhyJ4tGK4+In4FHvG033VP34fUP009mz9ozD3lKIeDV1KPBNOQWVag5PMw+miIQ0/ATcxozQESDsC5AfCWngFkmsMo6+Lytwo1ruC29COlKFvTIF8zghSS4eQVCzfb9ujbMavsZZzjOz7ew48KHZWRHYl64azrfwuxmV5MGp5ME7WoufmYWxU3wOIaSvVD3YicwwDkmDG/G9Pmp0ddaEkJbTxdeJ1c3lyiNsrEfM8NcI86VlIC8RKegAMzEOQhfjvioMZGf/8S+Vhx1mkosnbNlktP8zfAS4IMMSANgzlAAAAAElFTkSuQmCC",x:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACEklEQVQ4y61S/U9SYRhlbW13/Q0V5Woub05zfZkCXhUhpmmb8v3h5ZKoCQjcwVBi1Q+19Zf0d2lWxpeR3AuX93J8qGVjgK2tZ3u3d3t2znmecx6D4R+rsS5dGdiEnDXS4weCQ2Fe9QUSdafH3B+c3UM7k4OeSPWQNIIi3xAjaG5u48fz1Y+1peU7PWAU3qBNT0/KaG3tnJOogXWe1NGKJYB8AZ3/ic2RqMxaL/0iSGe4dlLW23uvgPcfoOfyHQI0RYlX/SGe1KHtxAHqqyERJwtPWUWYv9w1oh5PcuxlnOlyFnj7DiydQSMcAalD244Buf2f/6rVTuA5rq9JregW15Q2WCu2S+u8BvYLBMwD2RxUfxDVeRurzMxyF8cUFDnFG9CRo3V8QcDtA+QMqnMLetkicH/NWfH4O1EBlAacHmDVBeymaG87ipPT/MVgt49XvH5okSiQkgmYBuK0DhmorrlQMVnwdXyiP0nd5eUVjw+atAFQjIrbCzKLlabN+unSChDdRP3ZCor3H+JoeKSbhC6LJ3Vo4RekmoRCo5NZrDRl5oqPJrnjiQesZrUBYQmndgeOR8dweGPoDwldllB3uqGJEpQ1N8gsVnpiOjfsy+g493nkLvtuEaA4FvFt7B4OrhmFrinosoTa4jLK5hmdzOpx++j2MPdp6BbrC/5dZZNFKD6eGhjVofEmd3D1umD4n3UGltFKFJhJvx0AAAAASUVORK5CYII=",spinner:"data:image/gif;base64,R0lGODlhEAAQAPUCAHR2dOTi5Pz6/PTy9MzKzNTW1Ly6vHx+fOTm5LSytHx6fLy+vPT29Nze3ISChIyOjOzq7JSWlJyenKSmpNTS1JSSlJyanNza3Pz+/MTGxOzu7KSipKyqrIyKjISGhLS2tMTCxMzOzKyurP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQJBQACACwAAAAAEAAQAAAFUaAgjsJ1kWgpXoBypsIGbGV7BlMwMi3AlK/JjCSjoXA60g+m3Eg0TGJLEo1EYtPqFSLZQKLHRRIcUNiODcxo0VscXTszXPMVYC7qnXiVAftFIQAh+QQJBQABACwAAAAADwAQAAAFUWAgjoEGkeioKYqWBouzlKzLZMLoAI5oihlFZhSboQS4l7JkMOSWMJ5h2TRIqc4mA6q6bKEMD+9LIl94QohEcgp/w+MKq+IrewMdNJdyOFBQIQAh+QQJBQAKACwAAAEADwAPAAAFSaAijkpVkWRhFaI5ImQEWKgSAMG71jbvv5TfC3AI+igFCtHIS9qYQtGgSYCMJDMU5LC0EXECgyH8JbSyCWICwS2+zllIlbojhQAAIfkECQUAEAAsAAABABAADwAABVMgJI6QYZDosAyiOTLoAiwoxBzwa7C1UP8/BAJoezwaCIVi+DMCjkpmzfmwSXvGAFEkCPhGMhpJ4PxCHM9WwfYEaFsOGuFJICvNJNnMih8nEjkkIQAh+QQJBQAGACwAAAEAEAAPAAAFV6AhjgZFiUMxkNiFiaYxOICzwsBFlnU+ti8WzbYrylS/oHHA4Qwwj4dyx6k5owKjoargyKY7plPL2hUihWLVO4p0URBZLwtDyxWBLYBdLNTSMmQtBGAGIQAh+QQJBQABACwBAAAADwAQAAAGVsCAUNh4PBrDZNIIeAQwGkxyIOw0OxhLU/oEUIudBqTpHVKV2a1yLYiu3xhQRvD5vIlNuf0Oyt/Nclx/aAZnSRlhQwYABkJtVU2AGl0KX4lsfoMBYm9BACH5BAkFAAQALAEAAAAPABAAAAZVQIJQOOBwBsMkYoEgbAAATpKogAY4UOnn8BEuoNHiBnmAUq3TbZfInLrf08uFEArB6db6/VKd39l/bxgXAm4XEn54iUMSUUMChF4bVItJHR2BRIVuQQAh+QQFBQABACwAAAAAEAAPAAAGWsCAcCgAgQTDZIBxYQRAAABIKWR4FB5mdPGshIYXrKJpRFYAFeI1qwx5k0UkNUlxjOdVTcAexWuwf1EOflEadQ4UeEt6io0DcwwLTmqPbQpccGAZVZKKIiJzQQA7"},x=function(t){var n=t.className,r=t.title,o=t.type;return e.h("img",{alt:"".concat(o," icon"),className:n,src:k[o],title:r})},E=function(t){var n=t.className,r=t.site,o=t.title;return r.icon?e.h("img",{alt:r.title,className:n,src:r.icon,title:o}):null},Q="Sites_searchInput__1iJDL",L="Sites_resultCount__2p4vG",R="Sites_siteList__1Y3wR",B="Sites_catList__6txMX",I="Sites_checked__3D9QY",O="Sites_title__1Gu_F",M="Sites_extraIcon__jwLPa",N="Sites_siteIcon__3uzGl";C(".Sites_searchInput__1iJDL{background-color:hsla(0,0%,100%,.9);height:24px;line-height:normal;padding:3px 7px;width:100%;border-radius:3px;border:1px solid #a6a6a6;border-top-color:#949494;box-shadow:inset 0 1px 0 rgba(0,0,0,.07);outline:0;transition:all .1s linear}.Sites_searchInput__1iJDL:focus{background-color:#fff;border-color:#e77600;box-shadow:0 0 2px 2px rgba(228,121,17,.25)}.Sites_resultCount__2p4vG{font-weight:700;margin-bottom:8px}.Sites_resultCount__2p4vG>span{color:#000}.Sites_siteList__1Y3wR .Sites_catList__6txMX{display:flex;flex-wrap:wrap}.Sites_siteList__1Y3wR .Sites_catList__6txMX h4{width:100%}.Sites_siteList__1Y3wR .Sites_catList__6txMX label{align-items:center;color:#444;display:flex;flex-flow:row;padding:0 6px;transition:color .1s;width:25%}.Sites_siteList__1Y3wR .Sites_catList__6txMX label:hover{color:#222}.Sites_siteList__1Y3wR .Sites_catList__6txMX label.Sites_checked__3D9QY span{color:#000}.Sites_siteList__1Y3wR .Sites_catList__6txMX label .Sites_title__1Gu_F{flex-grow:1;overflow:hidden;text-overflow:ellipsis}.Sites_siteList__1Y3wR .Sites_catList__6txMX label input{margin-right:4px}.Sites_siteList__1Y3wR .Sites_catList__6txMX label .Sites_extraIcon__jwLPa{height:12px;margin-left:4px;width:12px}.Sites_siteList__1Y3wR .Sites_catList__6txMX label .Sites_siteIcon__3uzGl{flex-shrink:0;margin-right:6px}");var j=function(t){var n=t.q,r=t.setQ;return e.h("input",{className:Q,onInput:function(e){r(e.target.value.toLowerCase().trim())},placeholder:"Search",value:n})},T=function(t){var n=t.size,r="".concat(n,"px"),o={display:"inline-block",height:r,width:r};return e.h("div",{className:N,style:o})},z=function(t){var n=t.checked,r=t.setEnabled,o=t.site,i=e.h("input",{checked:n,onInput:function(e){return r((function(t){return e.target.checked?[].concat(c(t),[o.id]):t.filter((function(e){return e!==o.id}))}))},type:"checkbox"}),a=o.icon?e.h(E,{className:N,site:o,title:o.title}):e.h(T,{size:16}),s=e.h("span",{className:O,title:o.title},o.title),l=[o.noAccessMatcher?e.h(x,{className:M,title:"Site is access-restricted.",type:"lock"}):null,o.noResultsMatcher?e.h(x,{className:M,title:"Site allows fetching of results.",type:"tick"}):null];return e.h("label",{className:n?I:null},i,a," ",s," ",l)},K=function(t){var n=t.enabled,r=t.name,o=t.setEnabled,i=t.sites,a=i.map((function(t){return e.h(z,{checked:n.includes(t.id),setEnabled:o,site:t})}));return e.h("div",{className:B},e.h("h4",null,r," ",e.h("span",null,"(",i.length,")")),a)},D=function(n){var r=n.enabledSites,o=n.setEnabledSites,i=n.sites,a=l(t.useState(""),2),s=a[0],c=a[1],u=Object.keys(_).map((function(e){var t=i.filter((function(t){return t.category===e}));return s.length?t.filter((function(e){return e.title.toLowerCase().includes(s)})):t})),A=Object.entries(_).map((function(t,n){var i=l(t,2),a=i[0],s=i[1];return u[n].length?e.h(K,{enabled:r,key:a,name:s,setEnabled:o,sites:u[n]}):null})),p=u.reduce((function(e,t){return e+t.length}),0);return e.h(e.Fragment,null,e.h(j,{q:s,setQ:c}),e.h("div",{className:L},"Showing ",e.h("span",null,p)," sites."),e.h("div",{className:R},A))},G=function(){return e.h(e.Fragment,null,e.h("h3",null,f),e.h("p",null,"Adds all kinds of links to IMDb, customizable!"),e.h("ul",null,e.h("li",null,e.h("a",{target:"_blank",rel:"noreferrer",href:p},"GitHub")),e.h("li",null,e.h("a",{target:"_blank",rel:"noreferrer",href:"https://greasyfork.org/scripts/17154-imdb-link-em-all"},"Greasy Fork")),e.h("li",null,e.h("a",{href:"https://github.com/buzz/imdb-link-em-all/blob/master/ADDING-SITES.md"},"Add new sites"))))},U="Config_popover__3RK3L",V="Config_inner__2Sbjz",Y="Config_top__2kgQ3",F="Config_link__3aqRB",J="Config_active__iBK3y",P="Config_body__2JuhF",W="Config_controls__3hBBQ";C('.Config_popover__3RK3L{background-color:#a5a5a5;border-radius:4px;color:#333;display:block;font-family:Verdana,Arial,sans-serif;font-size:11px;left:-550px;line-height:1.5rem;padding:10px;position:absolute;top:28px;white-space:nowrap;width:800px;z-index:100}.Config_popover__3RK3L:before{border:8px solid transparent;border-bottom-color:#a5a5a5;content:"";display:block;height:8px;right:234px;position:absolute;top:-16px;width:0}.Config_popover__3RK3L .Config_inner__2Sbjz{display:flex;flex-direction:column;text-shadow:0 1px 0 hsla(0,0%,100%,.2)}.Config_popover__3RK3L .Config_inner__2Sbjz .Config_top__2kgQ3{display:flex;flex-direction:row}.Config_popover__3RK3L .Config_inner__2Sbjz .Config_top__2kgQ3 .Config_link__3aqRB{flex-grow:1;text-align:right}.Config_popover__3RK3L .Config_inner__2Sbjz .Config_top__2kgQ3 .Config_link__3aqRB>a{color:#333;margin-left:12px;margin-right:4px}.Config_popover__3RK3L .Config_inner__2Sbjz .Config_top__2kgQ3 .Config_link__3aqRB>a:visited{color:#333}.Config_popover__3RK3L .Config_inner__2Sbjz .Config_top__2kgQ3>button{background-color:rgba(0,0,0,.05);border-bottom-left-radius:0;border-bottom-right-radius:0;border-top-left-radius:2px;border-top-right-radius:2px;border:1px solid rgba(0,0,0,.25);border-bottom:transparent;color:#424242;font-size:12px;margin:0 6px 0 0;outline:none;padding:0 6px;transform:translateY(1px);text-shadow:0 1px 0 hsla(0,0%,100%,.2)}.Config_popover__3RK3L .Config_inner__2Sbjz .Config_top__2kgQ3>button:hover{background-color:rgba(0,0,0,.1);color:#222}.Config_popover__3RK3L .Config_inner__2Sbjz .Config_top__2kgQ3>button.Config_active__iBK3y{background-color:#c2c2c2;color:#222}.Config_popover__3RK3L .Config_inner__2Sbjz .Config_top__2kgQ3>button:last-child{margin-right:0}.Config_popover__3RK3L .Config_inner__2Sbjz .Config_body__2JuhF{background-color:#c2c2c2;border-bottom-left-radius:2px;border-bottom-right-radius:2px;border-top-right-radius:2px;border:1px solid rgba(0,0,0,.25);padding:12px 10px}.Config_popover__3RK3L .Config_inner__2Sbjz .Config_body__2JuhF>div{overflow:hidden}.Config_popover__3RK3L .Config_inner__2Sbjz .Config_body__2JuhF>div>:first-child{margin-top:0}.Config_popover__3RK3L .Config_inner__2Sbjz .Config_body__2JuhF>div>:last-child{margin-bottom:0}.Config_popover__3RK3L .Config_inner__2Sbjz .Config_controls__3hBBQ{display:flex;flex-direction:row;margin-top:10px}.Config_popover__3RK3L .Config_inner__2Sbjz .Config_controls__3hBBQ>div:first-child{flex-grow:1}.Config_popover__3RK3L .Config_inner__2Sbjz .Config_controls__3hBBQ button{padding-bottom:0;padding-top:0;margin-right:12px}');var H=[["show_category_captions","Show category captions"],["open_blank","Open links in new tab"],["fetch_results","Automatically fetch results"]],q=function(n){var r=n.config,o=n.setConfig,i=n.setShow,a=n.show,s=n.sites,u=l(t.useState(r.enabled_sites),2),A=u[0],h=u[1],_=t.useState(r.show_category_captions),g=t.useState(r.open_blank),d=t.useState(r.fetch_results),b=l(_,2),m=b[0],S=b[1],y=l(g,2),C=y[0],v=y[1],k=l(d,2),x=k[0],E=k[1],Q=[_,g,d],L=H.map((function(e,t){return[].concat(c(e),c(Q[t]))})),R=l(t.useState(0),2),B=R[0],I=R[1],O=[{title:"Sites",comp:e.h(D,{enabledSites:A,setEnabledSites:h,sites:s})},{title:"Options",comp:e.h(w,{options:L})},{title:"About",comp:e.h(G,null)}];return e.h("div",{className:U,style:{display:a?"block":"none"}},e.h("div",{className:V},e.h("div",{className:Y},O.map((function(t,n){var r=t.title;return e.h("button",{className:B===n?J:null,type:"button",onClick:function(){return I(n)}},r)})),e.h("div",{className:F},e.h("a",{target:"_blank",rel:"noreferrer",href:p},f))),e.h("div",{className:P},O.map((function(t,n){var r=t.comp;return e.h("div",{style:{display:B===n?"block":"none"}},r)}))),e.h("div",{className:W},e.h("div",null,e.h("button",{className:"btn primary small",onClick:function(){o({enabled_sites:A,fetch_results:x,open_blank:C,show_category_captions:m}),i(!1)},type:"button"},"OK"),e.h("button",{className:"btn small",onClick:function(){i(!1),h(r.enabled_sites),E(r.fetch_results),v(r.open_blank),S(r.show_category_captions)},type:"button"},"Cancel")))))},Z=function(e,t){var n=t.id,r=t.title,o=t.year,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e.replace(new RegExp("{{IMDB_TITLE}}","g"),i?encodeURIComponent(r):r).replace(new RegExp("{{IMDB_ID}}","g"),n).replace(new RegExp("{{IMDB_YEAR}}","g"),o)},X=function(e,n){var r=l(t.useState(null),2),o=r[0],i=r[1];return t.useEffect((function(){var t;if(n.noResultsMatcher){var r=n.url,o={timeout:2e4,onload:function(e){return i(function(e,t){if(e.responseHeaders&&e.responseHeaders.includes("Refresh: 0; url="))return m;if(!e.responseText)return y;if(e.responseText.includes("The blog that you are about to view may contain content only suitable for adults."))return m;if(e.responseText.includes("Checking your browser before accessing"))return m;if(t.noAccessMatcher&&(Array.isArray(t.noAccessMatcher)?t.noAccessMatcher:[t.noAccessMatcher]).some((function(t){return e.responseText.includes(t)})))return m;if(Array.isArray(t.noResultsMatcher)){var n,r=l(t.noResultsMatcher,4),o=r[0],i=r[1],a=r[2],s=r[3],c=e.responseHeaders.match(/content-type:\s([^\s;]+)/),u=c?c[1]:"text/html";try{n=(new DOMParser).parseFromString(e.responseText,u)}catch(e){return console.error("Could not parse document!"),y}switch(o){case"EL_COUNT":var A;try{A=n.querySelectorAll(i)}catch(e){return console.error(e),y}if("GT"===a&&A.length>s)return b;if("LT"===a&&A.length<s)return b}return d}return(Array.isArray(t.noResultsMatcher)?t.noResultsMatcher:[t.noResultsMatcher]).some((function(t){return e.responseText.includes(t)}))?d:b}(e,n))},onerror:function(e){console.error("Failed to fetch results from URL '".concat(r,"': ").concat(e.statusText)),i(y)},ontimeout:function(){return i(S)}};if(Array.isArray(r)){var a=l(r,2),s=a[0],c=a[1];o.method="POST",o.url=s,o.headers={"Content-Type":"application/x-www-form-urlencoded"},o.data=Object.keys(c).map((function(t){var n=encodeURIComponent(Z(c[t],e));return"".concat(t,"=").concat(n)})).join("&")}else o.method="GET",o.url=Z(r,e);t=GM.xmlHttpRequest(o),i(g)}return function(){t&&t.abort&&t.abort()}}),[e,n]),o},$="SiteLink_linkWrapper__2uDyT",ee="SiteLink_resultsIcon__3_V-k";C(".SiteLink_linkWrapper__2uDyT{display:inline-block;margin-right:4px}.SiteLink_linkWrapper__2uDyT img{vertical-align:text-bottom}.SiteLink_linkWrapper__2uDyT a{white-space:pre-line}.SiteLink_linkWrapper__2uDyT a>img{height:16px;width:16px;margin-right:4px}.SiteLink_linkWrapper__2uDyT .SiteLink_resultsIcon__3_V-k{margin-left:4px}");var te=function(t){var n,r,o=t.imdbInfo,i=t.site;switch(X(o,i)){case g:n="spinner",r="Loading…";break;case d:n="x",r="No Results found!";break;case b:n="tick",r="Results found!";break;case m:n="lock",r="You have to login to this site!";break;case S:n="timeout",r="You have to login to this site!";break;case y:n="error",r="Error fetching results! (See dev console for details)";break;default:return null}return e.h(x,{className:ee,title:r,type:n})},ne=function(){return e.h(e.Fragment,null," ",e.h("span",{className:"ghost"},"|"))},re=function(n){var r=n.config,o=n.imdbInfo,a=n.last,s=n.site,c=r.open_blank?{target:"_blank",rel:"noreferrer"}:{},u=function(e,n,r){var o=t.useRef(),i=Array.isArray(e),a=i?"":Z(e,r,!1);return t.useEffect((function(){if(i){var t=l(e,2),a=t[0],s=t[1],c=document.createElement("form");c.action=a,c.method="POST",c.style.display="none",c.target=n?"_blank":"_self",Object.keys(s).forEach((function(e){var t=document.createElement("input");t.type="text",t.name=e,t.value=Z(s[e],r,!1),c.appendChild(t)})),document.body.appendChild(c),o.current=c}return function(){o.current&&o.current.remove()}})),[a,function(){i&&o.current&&(console.log("POST"),o.current.submit())}]}(s.url,r.open_blank,o),A=l(u,2),p=A[0],f=A[1];return e.h("span",{className:$},e.h("a",i({href:p,onClick:f},c),e.h(E,{site:s}),e.h("span",null,s.title)),e.h(te,{imdbInfo:o,site:s}),a?null:e.h(ne,null))},oe="LinkList_linkList__rlGOn",ie="LinkList_h4__2axTi";C(".LinkList_linkList__rlGOn{line-height:1.6rem}.LinkList_h4__2axTi{margin-top:.5rem}");var ae=function(t){var n=t.config,r=t.imdbInfo,o=t.sites;return Object.entries(_).map((function(t){var i=l(t,2),a=i[0],s=i[1],c=o.filter((function(e){return e.category===a&&n.enabled_sites.includes(e.id)}));if(!c.length)return null;var u=n.show_category_captions?e.h("h4",{className:ie},s):null;return e.h(e.Fragment,null,u,e.h("div",{className:oe},c.map((function(t,o){return e.h(re,{config:n,imdbInfo:r,last:o===c.length-1,site:t})}))))}))},se="App_configWrapper__2KuAE";C(".App_configWrapper__2KuAE{position:absolute;right:20px;top:20px}.App_configWrapper__2KuAE>button{background:transparent;border:none;outline:none;padding:0}.App_configWrapper__2KuAE>button>img{vertical-align:baseline}");var le=function(){var e=r(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,GM.getValue("config");case 3:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ce=function(){var e=r(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",GM.setValue("config",JSON.stringify(t)));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ue=function(){var e=l(t.useState([]),2),n=e[0],r=e[1];return t.useEffect((function(){new Promise((function(e,t){return GM.xmlHttpRequest({method:"GET",url:"https://raw.githubusercontent.com/buzz/imdb-link-em-all/master/sites.json",nocache:!0,onload:function(n){var r=n.response,o=n.status,i=n.statusText;if(200===o)try{e(JSON.parse(r).sort((function(e,t){return e.title.localeCompare(t.title)})))}catch(e){t(e)}else t(new Error("Could not load sites: ".concat(o," ").concat(i)))},onerror:function(e){var n=e.status,r=e.statusText;t(new Error("Could not load sites: ".concat(n," ").concat(r)))}})})).then((function(e){return r(e)}))}),[]),n},Ae=function(){var e=/^\/title\/tt([0-9]{7,8})\/([a-z]*)/.exec(window.location.pathname);if(!e)throw new Error("Could not parse IMDb URL!");var t={id:e[1],layout:["reference","combined"].includes(e[2])?"legacy":"new"},n="legacy"===t.layout?"h3[itemprop=name]":"h1";t.title=document.querySelector(n).innerText.trim();var r=/^(.+)\s+\((\d+)\)/.exec(t.title);return r&&(t.title=r[1].trim(),t.year=parseInt(r[2].trim(),10)),t}(),pe=document.querySelector(".title-overview");if(!pe)throw new Error("LTA: Could not find target container!");var fe=document.createElement("div");fe.style.position="relative",fe.classList.add("article"),pe.appendChild(fe),e.render(e.h((function(n){var r=n.imdbInfo,o=function(){var e=l(t.useState(),2),n=e[0],r=e[1];return t.useEffect((function(){le().then((function(e){return r(e)})).catch((function(){return r(h)}))}),[]),t.useEffect((function(){n&&ce(n)}),[n]),{config:n,setConfig:r}}(),i=o.config,a=o.setConfig,c=ue(),u=l(t.useState(!1),2),A=u[0],p=u[1];return t.useEffect((function(){i&&i.first_run&&(p(!0),a((function(e){return s(s({},e),{},{first_run:!1})})))}),[i]),i&&c.length?e.h(e.Fragment,null,e.h("div",{className:se},e.h("button",{onClick:function(){return p((function(e){return!e}))},title:"Configure",type:"button"},e.h(x,{type:"cog"})),e.h(q,{config:i,setConfig:a,setShow:p,sites:c,show:A})),e.h(ae,{config:i,imdbInfo:r,sites:c})):null}),{imdbInfo:Ae}),fe)}(preact,preactHooks);
